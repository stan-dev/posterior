<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Pareto smoothing diagnostics — pareto_diags • posterior</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pareto smoothing diagnostics — pareto_diags"><meta name="description" content="Compute diagnostics for Pareto smoothing the tail draws of x by
replacing tail draws by order statistics of a generalized Pareto
distribution fit to the tail(s)."><meta property="og:description" content="Compute diagnostics for Pareto smoothing the tail draws of x by
replacing tail draws by order statistics of a generalized Pareto
distribution fit to the tail(s)."><meta property="og:image" content="https://mc-stan.org/posterior/logo.svg"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      posterior
    </a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.6.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstanarm">rstanarm</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org">Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/mcmc_stan"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/posterior"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/"><span class="fa fa-users"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Pareto smoothing diagnostics</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/posterior/blob/master/R/pareto_smooth.R" class="external-link"><code>R/pareto_smooth.R</code></a></small>
      <div class="d-none name"><code>pareto_diags.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute diagnostics for Pareto smoothing the tail draws of x by
replacing tail draws by order statistics of a generalized Pareto
distribution fit to the tail(s).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pareto_diags</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">pareto_diags</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  tail <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"both"</span>, <span class="st">"right"</span>, <span class="st">"left"</span><span class="op">)</span>,</span>
<span>  r_eff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ndraws_tail <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  are_log_weights <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'rvar'</span></span>
<span><span class="fu">pareto_diags</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pareto_khat_threshold</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">pareto_khat_threshold</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'rvar'</span></span>
<span><span class="fu">pareto_khat_threshold</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pareto_min_ss</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">pareto_min_ss</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'rvar'</span></span>
<span><span class="fu">pareto_min_ss</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pareto_convergence_rate</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">pareto_convergence_rate</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'rvar'</span></span>
<span><span class="fu">pareto_convergence_rate</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>(multiple options) One of:</p><ul><li><p>A matrix of draws for a single variable (iterations x chains). See
<code><a href="extract_variable_matrix.html">extract_variable_matrix()</a></code>.</p></li>
<li><p>An <code><a href="rvar.html">rvar</a></code>.</p></li>
</ul></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to individual methods (if applicable).</p></dd>


<dt id="arg-tail">tail<a class="anchor" aria-label="anchor" href="#arg-tail"></a></dt>
<dd><p>(string) The tail to diagnose/smooth:</p><ul><li><p><code>"right"</code>: diagnose/smooth only the right (upper) tail</p></li>
<li><p><code>"left"</code>: diagnose/smooth only the left (lower) tail</p></li>
<li><p><code>"both"</code>: diagnose/smooth both tails and return the maximum k-hat value</p></li>
</ul><p>The default is <code>"both"</code>.</p></dd>


<dt id="arg-r-eff">r_eff<a class="anchor" aria-label="anchor" href="#arg-r-eff"></a></dt>
<dd><p>(numeric) relative effective sample size estimate. If
<code>r_eff</code> is NULL, it will be calculated assuming the draws are
from MCMC. Default is NULL.</p></dd>


<dt id="arg-ndraws-tail">ndraws_tail<a class="anchor" aria-label="anchor" href="#arg-ndraws-tail"></a></dt>
<dd><p>(numeric) number of draws for the tail. If
<code>ndraws_tail</code> is not specified, it will be calculated as
ceiling(3 * sqrt(length(x) / r_eff)) if length(x) &gt; 225 and
length(x) / 5 otherwise (see Appendix H in Vehtari et
al. (2024)).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>(logical) Should diagnostic messages be printed? If
<code>TRUE</code>, messages related to Pareto diagnostics will be
printed. Default is <code>FALSE</code>.</p></dd>


<dt id="arg-are-log-weights">are_log_weights<a class="anchor" aria-label="anchor" href="#arg-are-log-weights"></a></dt>
<dd><p>(logical) Are the draws log weights? Default is
<code>FALSE</code>. If <code>TRUE</code> computation will take into account that the
draws are log weights, and only right tail will be smoothed.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>List of Pareto smoothing diagnostics:</p><ul><li><p><code>khat</code>: estimated Pareto k shape parameter,</p></li>
<li><p><code>min_ss</code>: minimum sample size for reliable Pareto smoothed estimate,</p></li>
<li><p><code>khat_threshold</code>: khat-threshold for reliable Pareto smoothed estimate,</p></li>
<li><p><code>convergence_rate</code>: Pareto smoothed estimate RMSE convergence rate.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When the fitted Generalized Pareto Distribution is used to
smooth the tail values and these smoothed values are used to
compute expectations, the following diagnostics can give further
information about the reliability of these estimates.</p><ul><li><p><code>min_ss</code>: Minimum sample size for reliable Pareto smoothed
estimate. If the actual sample size is greater than <code>min_ss</code>, then
Pareto smoothed estimates can be considered reliable. If the actual
sample size is lower than <code>min_ss</code>, increasing the sample size
might result in more reliable estimates. For further details, see
Section 3.2.3, Equation 11 in Vehtari et al. (2024).</p></li>
<li><p><code>khat_threshold</code>: Threshold below which k-hat values result in
reliable Pareto smoothed estimates. The threshold is lower for
smaller effective sample sizes. If k-hat is larger than the
threshold, increasing the total sample size may improve reliability
of estimates. For further details, see Section 3.2.4, Equation 13
in Vehtari et al. (2024).</p></li>
<li><p><code>convergence_rate</code>: Relative convergence rate compared to the
central limit theorem. Applicable only if the actual sample size
is sufficiently large (greater than <code>min_ss</code>). The convergence
rate tells the rate at which the variance of an estimate reduces
when the sample size is increased, compared to the central limit
theorem convergence rate. See Appendix B in Vehtari et al. (2024).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Aki Vehtari, Daniel Simpson, Andrew Gelman, Yuling Yao and
Jonah Gabry (2024). Pareto Smoothed Importance Sampling.
<em>Journal of Machine Learning Research</em>, 25(72):1-58.
<a href="https://jmlr.org/papers/v25/19-556.html" class="external-link">PDF</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="pareto_khat.html">pareto_khat</a></code>, <code>pareto_min_ss</code>,
<code>pareto_khat_threshold</code>, and <code>pareto_convergence_rate</code> for
individual diagnostics; and <code><a href="pareto_smooth.html">pareto_smooth</a></code> for Pareto smoothing
draws.</p>
<p>Other diagnostics:
<code><a href="ess_basic.html">ess_basic</a>()</code>,
<code><a href="ess_bulk.html">ess_bulk</a>()</code>,
<code><a href="ess_quantile.html">ess_quantile</a>()</code>,
<code><a href="ess_sd.html">ess_sd</a>()</code>,
<code><a href="ess_tail.html">ess_tail</a>()</code>,
<code><a href="mcse_mean.html">mcse_mean</a>()</code>,
<code><a href="mcse_quantile.html">mcse_quantile</a>()</code>,
<code><a href="mcse_sd.html">mcse_sd</a>()</code>,
<code><a href="pareto_khat.html">pareto_khat</a>()</code>,
<code><a href="rhat.html">rhat</a>()</code>,
<code><a href="rhat_basic.html">rhat_basic</a>()</code>,
<code><a href="rhat_nested.html">rhat_nested</a>()</code>,
<code><a href="rstar.html">rstar</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="extract_variable_matrix.html">extract_variable_matrix</a></span><span class="op">(</span><span class="fu"><a href="example_draws.html">example_draws</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mu"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">pareto_diags</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $khat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.1883631</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $min_ss</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 17.06389</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $khat_threshold</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6156891</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence_rate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9872523</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="draws_rvars.html">as_draws_rvars</a></span><span class="op">(</span><span class="fu"><a href="example_draws.html">example_draws</a></span><span class="op">(</span><span class="st">"multi_normal"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">pareto_diags</span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">Sigma</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $khat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1]       [,2]        [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.04795008 0.04397814  0.04538642</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.04397814 0.08793028  0.07088579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.04538642 0.07088579 -0.08599429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $min_ss</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1]     [,2]     [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 11.22962 11.11735 11.15692</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 11.11735 12.48554 11.92049</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 11.15692 11.92049 10.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $khat_threshold</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]      [,2]      [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.6156891 0.6156891 0.6156891</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.6156891 0.6156891 0.6156891</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.6156891 0.6156891 0.6156891</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $convergence_rate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]      [,2]      [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.9984733 0.9986277 0.9985736</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.9986277 0.9965542 0.9974598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.9985736 0.9974598 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul-Christian Bürkner, Jonah Gabry, Matthew Kay, Aki Vehtari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

