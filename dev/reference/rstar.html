<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- upstream: inst/BS5/templates/head.html; pkgdown-version: 2.1.3, fe04924 --><!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 --><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate R* convergence diagnostic — rstar • posterior</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0/tex-mml-chtml.js" integrity="sha256-qoRlVrS5NAnXSSSiMfFXwK8C9obG11Iybe4h2+bQYR4=" crossorigin="anonymous">
  </script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_3-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- Font Awesome 7.0.1 for Bluesky icon --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" referrerpolicy="no-referrer"><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate R* convergence diagnostic — rstar"><meta name="description" content="The rstar() function generates a measure of convergence for MCMC draws
based on whether it is possible to determine the Markov chain that generated
a draw with probability greater than chance. To do so, it fits a machine
learning classifier to a training set of MCMC draws and evaluates its
predictive accuracy on a testing set: giving the ratio of accuracy to
predicting a chain uniformly at random."><meta property="og:description" content="The rstar() function generates a measure of convergence for MCMC draws
based on whether it is possible to determine the Markov chain that generated
a draw with probability greater than chance. To do so, it fits a machine
learning classifier to a training set of MCMC draws and evaluates its
predictive accuracy on a testing set: giving the ratio of accuracy to
predicting a chain uniformly at random."><meta property="og:image" content="https://mc-stan.org/posterior/logo.svg"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <!-- upstream: inst/BS5/templates/navbar.html; pkgdown-version: 2.1.3, fe04924 -->
<!-- https://github.com/r-lib/pkgdown/tree/fe04924b3df129bea60ac871614b01d87bcae147 -->
<nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">


    <a class="navbar-brand me-2" href="../index.html">
      <!-- Add Stan logo -->
      <picture><source type="image/svg+xml" srcset="../logo.svg"><img src="../logo.png" class="stan-logo" alt="Stan blue hex logo"></source></picture>
      posterior
    </a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.6.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Other Packages</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://mc-stan.org/rstan">rstan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr">cmdstanr</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstanarm">rstanarm</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/bayesplot">bayesplot</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/shinystan">shinystan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/loo">loo</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/projpred">projpred</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/rstantools">rstantools</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org">Stan</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://twitter.com/mcmc_stan"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stan-dev/posterior"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://discourse.mc-stan.org/"><span class="fa fa-users"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Calculate R* convergence diagnostic</h1>
      <small class="dont-index">Source: <a href="https://github.com/stan-dev/posterior/blob/master/R/rstar.R" class="external-link"><code>R/rstar.R</code></a></small>
      <div class="d-none name"><code>rstar.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>rstar()</code> function generates a measure of convergence for MCMC draws
based on whether it is possible to determine the Markov chain that generated
a draw with probability greater than chance. To do so, it fits a machine
learning classifier to a training set of MCMC draws and evaluates its
predictive accuracy on a testing set: giving the ratio of accuracy to
predicting a chain uniformly at random.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rstar</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  split <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  uncertainty <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"rf"</span>,</span>
<span>  hyperparameters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  training_proportion <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  nsimulations <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>(draws) A <code><a href="draws_df.html">draws_df</a></code> object or one coercible to a <code>draws_df</code> object.</p></dd>


<dt id="arg-split">split<a class="anchor" aria-label="anchor" href="#arg-split"></a></dt>
<dd><p>(logical) Should the estimate be computed on split chains? The
default is <code>TRUE</code>.</p></dd>


<dt id="arg-uncertainty">uncertainty<a class="anchor" aria-label="anchor" href="#arg-uncertainty"></a></dt>
<dd><p>(logical). Indicates whether to provide a vector of R*
values representing uncertainty in the calculated value (if <code>TRUE</code>) or a
single value (if <code>FALSE</code>). The default is <code>TRUE.</code></p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>(string) The machine learning classifier to use (must be
available in the <span class="pkg">caret</span> package). The default is <code>"rf"</code>, which calls
the random forest classifier.</p></dd>


<dt id="arg-hyperparameters">hyperparameters<a class="anchor" aria-label="anchor" href="#arg-hyperparameters"></a></dt>
<dd><p>(named list) Hyperparameter settings passed to the classifier.
The default for the random forest classifier (<code>method = "rf"</code>) is
<code>list(mtry = floor(sqt(nvariables(x))))</code>.
The default for the gradient-based model (<code>method = "gbm"</code>) is
<code>list(interaction.depth = 3, n.trees = 50, shrinkage = 0.1, n.minobsinnode = 10)</code>.</p></dd>


<dt id="arg-training-proportion">training_proportion<a class="anchor" aria-label="anchor" href="#arg-training-proportion"></a></dt>
<dd><p>(positive real) The proportion (in <code>(0,1)</code>) of
iterations in used to train the classifier. The default is <code>0.7</code>.</p></dd>


<dt id="arg-nsimulations">nsimulations<a class="anchor" aria-label="anchor" href="#arg-nsimulations"></a></dt>
<dd><p>(positive integer) The number of R* values in the
returned vector if <code>uncertainty</code> is <code>TRUE</code>. The default is <code>1000.</code></p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments passed to <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">caret::train()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric vector of length 1 (by default) or length <code>nsimulations</code>
(if <code>uncertainty = TRUE</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>rstar()</code> function provides a measure of MCMC convergence based
on whether it is possible to determine the chain that generated a
particular draw with a probability greater than chance. To do so, it fits a
machine learning classifier to a subset of the original MCMC draws (the
training set) and evaluates its predictive accuracy on the remaining draws
(the testing set). If predictive accuracy exceeds chance (i.e. predicting
the chain that generated a draw uniformly at random), the diagnostic
measure R* will be above 1, indicating that convergence has yet to occur.
This statistic is recently developed, and it is currently unclear what is a
reasonable threshold for diagnosing convergence.</p>
<p>The statistic, R*, is stochastic, meaning that each time the test is run,
unless the random seed is fixed, it will generally produce a different
result. To minimize the implications of this stochasticity, it is
recommended to repeatedly run this function to calculate a distribution of
R*; alternatively, an approximation to this distribution can be obtained by
setting <code>uncertainty = TRUE</code>, although this approximation of uncertainty
will generally have a lower mean.</p>
<p>By default, a random forest classifier is used (<code>method = "rf"</code>), which tends
to perform best for target distributions of around 4 dimensions and above.
For lower dimensional targets, gradient boosted models (called via
<code>method = "gbm"</code>) tend to have a higher classification accuracy. On a given
MCMC sample, it is recommended to try both of these classifiers.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Ben Lambert, Aki Vehtari (2020) R*: A robust MCMC convergence
diagnostic with uncertainty using gradient-boosted machines.
<em>arXiv preprint</em> <code>arXiv:2003.07900</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other diagnostics:
<code><a href="ess_basic.html">ess_basic()</a></code>,
<code><a href="ess_bulk.html">ess_bulk()</a></code>,
<code><a href="ess_quantile.html">ess_quantile()</a></code>,
<code><a href="ess_sd.html">ess_sd()</a></code>,
<code><a href="ess_tail.html">ess_tail()</a></code>,
<code><a href="mcse_mean.html">mcse_mean()</a></code>,
<code><a href="mcse_quantile.html">mcse_quantile()</a></code>,
<code><a href="mcse_sd.html">mcse_sd()</a></code>,
<code><a href="pareto_diags.html">pareto_diags()</a></code>,
<code><a href="pareto_khat.html">pareto_khat()</a></code>,
<code><a href="rhat.html">rhat()</a></code>,
<code><a href="rhat_basic.html">rhat_basic()</a></code>,
<code><a href="rhat_nested.html">rhat_nested()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/topepo/caret/" class="external-link">"caret"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">"randomForest"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="example_draws.html">example_draws</a></span><span class="op">(</span><span class="st">"eight_schools"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rstar</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rstar</span><span class="op">(</span><span class="va">x</span>, split <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rstar</span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"gbm"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># can pass additional arguments to methods</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rstar</span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"gbm"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># with uncertainty, returns a vector of R* values</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu">rstar</span><span class="op">(</span><span class="va">x</span>, uncertainty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu">rstar</span><span class="op">(</span><span class="va">x</span>, uncertainty <span class="op">=</span> <span class="cn">TRUE</span>, nsimulations <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># can use other classification methods in caret library</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rstar</span><span class="op">(</span><span class="va">x</span>, method <span class="op">=</span> <span class="st">"knn"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> randomForest 4.7-1.2</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Type rfNews() to see new features/changes/bug fixes.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘randomForest’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:ggplot2’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     margin</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iter   TrainDeviance   ValidDeviance   StepSize   Improve</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      1        2.0794            -nan     0.1000    0.0164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      2        2.0007            -nan     0.1000   -0.0397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      3        1.9414            -nan     0.1000   -0.0396</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      4        1.8824            -nan     0.1000   -0.0480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      5        1.8299            -nan     0.1000   -0.0616</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      6        1.7842            -nan     0.1000   -0.0264</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      7        1.7454            -nan     0.1000   -0.0780</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      8        1.7063            -nan     0.1000   -0.0227</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      9        1.6656            -nan     0.1000   -0.0256</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     10        1.6192            -nan     0.1000   -0.0399</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     20        1.2926            -nan     0.1000   -0.0332</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     40        0.8985            -nan     0.1000   -0.0259</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     50        0.7543            -nan     0.1000   -0.0373</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.933333</span>
<span class="r-plt img"><img src="rstar-1.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="rstar-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.533333</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul-Christian Bürkner, Jonah Gabry, Matthew Kay, Aki Vehtari.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

